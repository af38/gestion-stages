

<div class="flex flex-col relative overflow-x-auto mt-4 rounded-lg min-h-96">
    <div class="flex justify-between items-center mb-2">
        <select [(ngModel)]="d" (ngModelChange)="getAllTeachers()" class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-4/12 p-2.5" type="text">
            <option value="" selected>Département</option>
            <option *ngFor="let dp of departements" [value]="dp">{{dp}}</option>
        </select>
        <input [(ngModel)]="query" (ngModelChange)="getAllTeachers()" type="search" class="block w-1/3 p-2.5 text-sm border-gray-300 border rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="recherch">
    </div>
    <table class="w-full text-sm text-left text-black shadow-md mt-2">
        <thead class="text-xs text-black uppercase bg-gray-200 ">
            <tr>
                <th scope="col" class="px-6 py-3">Nom</th>
                <th scope="col" class="px-6 py-3">Prénom</th>
                <th scope="col" class="px-6 py-3">email</th>
                <th scope="col" class="px-6 py-3">CNI</th>
                <th scope="col" class="px-6 py-3">Département</th>
                <th scope="col" class="px-6 py-3">Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let teacher of teachers | paginate: { itemsPerPage: 4, currentPage: page, totalItems: totalLength }" class="bg-white border-b">
                <td class="px-6 py-4">{{teacher.utilisateur.nom}}</td>
                <td class="px-6 py-4">{{teacher.utilisateur.prenom}}</td>
                <td class="px-6 py-4">{{teacher.utilisateur.email}}</td>
                <td class="px-6 py-4">{{teacher.utilisateur.numTel}}</td>
                <td class="px-6 py-4">{{teacher.departement}}</td>
                <td class="px-6 py-4">
                    <p-button (click)="showDialogView(teacher)" icon="pi pi-eye" [rounded]="true" [raised]="true"></p-button>
                    <p-button (click)="showDialogEdit(teacher)" icon="pi pi-pencil" [rounded]="true" [raised]="true"  severity="info" class="mx-3"></p-button>
                    <p-button (click)="delete(teacher.idEnseignant)" icon="pi pi-trash" [rounded]="true" [raised]="true"  severity="danger"></p-button>
                </td>
            </tr>


        </tbody>
    </table>
</div>

@if(selectedTeacher){
    <!-- teacher profile -->
    <p-dialog class="text-center" header="voir"  [modal]="true" [(visible)]="visible_view" [style]="{width: '40vw'}" [draggable]="false" [resizable]="false" [breakpoints]="{ '960px': '75vw' }">
        <div class="grid grid-cols-2">
            <div class="flex justify-center text-left">
                <div>
                    <span class="block mb-3 font-semibold">Nom</span>
                    <span class="block mb-3 font-semibold">Prénom</span>
                    <span class="block mb-3 font-semibold">email</span>
                    <span class="block mb-3 font-semibold">Numéro de téléphone</span>
                    <span class="block mb-3 font-semibold">Departement</span>
                </div>
            </div>
            <div class="flex justify-center text-left">
                <div>
                    <span class="block mb-3">{{selectedTeacher.utilisateur.nom}}</span>
                    <span class="block mb-3">{{selectedTeacher.utilisateur.prenom}}</span>
                    <span class="block mb-3">{{selectedTeacher.utilisateur.email}}</span>
                    <span class="block mb-3">{{selectedTeacher.utilisateur.numTel}}</span>
                    <span class="block mb-3">{{selectedTeacher.departement}}</span>
                </div>
            </div>
        </div>
    </p-dialog>

    <!-- teacher edit -->
    <p-dialog class="text-center" header="modifier"  [modal]="true" [(visible)]="visible_edit" [style]="{width: '40vw'}" [draggable]="false" [resizable]="false" [breakpoints]="{ '960px': '75vw' }">
            <div class="flex justify-center text-left ">
                <div class="w-full">
                    <form [formGroup]="formGroup" class="w-full p-4 border border-gray-300 bg-white" (ngSubmit)="update($event)">
                        <div class="grid grid-cols-1 sm:grid-cols-2  gap-5">
                            <!-- Nom -->
                            <div>
                                <label class="block mb-2 text-sm font-medium" for="">Nom</label>
                                <input type="text" formControlName = "nom" name="nom"  class="block w-full p-2.5 text-sm border-gray-300 border rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                @if(getError("nom")){
                                    <span class="error">{{getError("nom")}}</span>
                                }
                            </div>

                            <!-- Prenom -->
                            <div>
                                <label class="block mb-2 text-sm font-medium" for="">Prénom</label>
                                <input type="text" formControlName = "prenom" name="prenom"  class="block w-full p-2.5 text-sm border-gray-300 border rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                @if(getError("prenom")){
                                    <span class="error">{{getError("prenom")}}</span>
                                }
                            </div>

                            <!-- Email -->
                            <div>
                                <label class="block mb-2 text-sm font-medium" for="">Email</label>
                                <input type="text" formControlName = "email" name="email"  class="block w-full p-2.5 text-sm border-gray-300 border rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                @if(getError("email")){
                                    <span class="error">{{getError("email")}}</span>
                                }
                            </div>

                            <!-- department -->
                            <div>
                                <label class="block mb-2 text-sm font-medium" for="">Département</label>
                                <input type="tel" formControlName = "departement" name="departement"  class="block w-full p-2.5 text-sm border-gray-300 border rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                @if(getError("departement")){
                                    <span class="error">{{getError("departement")}}</span>
                                }
                            </div>

                            <!-- TEL -->
                            <div>
                                <label class="block mb-2 text-sm font-medium" for="">Numéro de téléphone</label>
                                <input type="tel" formControlName = "numTel" name="numTel"  class="block w-full p-2.5 text-sm border-gray-300 border rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                @if(getError("numTel")){
                                    <span class="error">{{getError("numTel")}}</span>
                                }
                            </div>
                        </div>
                        <button type="submit" class="w-full mt-5 rounded-md bg-blue-600 text-center py-3 text-white" >modifier</button>
                    </form>
                </div>
            </div>

    </p-dialog>
}

<!-- delete confirmation modal -->
<p-toast></p-toast>
<p-confirmDialog #cd>
    <ng-template pTemplate="headless" let-message>
        <div class="flex flex-col gap-4 items-center p-5  rounded-lg bg-white">
            <div class="rounded-full bg-red-600 inline-flex justify-center items-center h-24 w-24">
                <i class="pi pi-question text-5xl text-white"></i>
            </div>

            <span class="font-bold text-2xl block mb-2 mt-4">
                {{ message.header }}
            </span>

            <p class="mb-0">{{ message.message }}</p>

            <div class=" w-full flex items-center gap-2 mt-4">
                <button
                    pButton
                    label="supprimer"
                    (click)="cd.accept()"
                    size="small"
                    [outlined]="true"
                    severity="danger"
                    class="w-32">
                </button>
                <button
                    pButton
                    label="Annuler"
                    (click)="cd.reject()"
                    size="small"
                    class="w-32 ">
                </button>
            </div>
        </div>
    </ng-template>
</p-confirmDialog>
<!-- start pagination -->
<div class="pagination text-center mt-4">
<pagination-controls
    (pageChange)="page = $event"
    previousLabel="précédent"
    nextLabel="suivant"
    ></pagination-controls>
</div>
<!-- end pagination -->

